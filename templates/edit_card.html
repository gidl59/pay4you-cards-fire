<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Modifica Card Pro</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico?v=2">
    <link rel="stylesheet" href="/static/style.css">
    <style>
        /* CSS SPECIFICO PER EDITING */
        .edit-container { max-width:900px; margin:20px auto; padding-bottom:100px; }
        .edit-box { background:#111; padding:25px; border-radius:15px; border:1px solid #333; margin-bottom:20px; position:relative;}
        .box-title { color:#00ffc8; margin-top:0; border-bottom:1px solid #333; padding-bottom:10px; margin-bottom:20px; text-transform:uppercase; font-size:14px; letter-spacing:1px; display:flex; justify-content:space-between; align-items:center;}
        
        .form-grid { display:grid; grid-template-columns: 1fr 1fr; gap:20px; }
        .full-width { grid-column: span 2; }
        
        label { display:block; color:#aaa; margin-bottom:5px; font-size:12px; font-weight:bold; }
        input[type="text"], textarea, select { width:100%; padding:12px; background:#222; border:1px solid #444; color:white; border-radius:6px; box-sizing:border-box; }
        input:focus { border-color:#00ffc8; outline:none; }
        
        /* ANTEPRIMA FOTO TONDA */
        .img-preview-box { text-align:center; background:#1a1a1a; padding:15px; border-radius:10px; }
        .circle-preview { 
            width:120px; height:120px; border-radius:50%; border:3px solid #00ffc8; 
            object-fit:cover; margin:10px auto; background:#000;
        }
        .rect-preview { width:100%; height:80px; object-fit:contain; background:#000; border:1px solid #444; }

        /* EFFETTI & SWITCH */
        .switch-group { display:flex; gap:20px; background:#222; padding:15px; border-radius:8px; align-items:center; }
        .radio-group label { display:inline-block; margin-right:15px; color:white; cursor:pointer;}
        
        .note { font-size:10px; color:#ff4444; margin-top:2px; }

        /* TASTO SALVA */
        .btn-save { position:fixed; bottom:20px; right:20px; background:linear-gradient(90deg, #0088cc, #00ffc8); color:#000; padding:15px 50px; border-radius:40px; border:none; font-weight:bold; font-size:16px; box-shadow:0 10px 30px rgba(0,255,200,0.3); cursor:pointer; z-index:999; }
    </style>
</head>
<body style="background:#050505; color:white; font-family:sans-serif;">

    <div class="dash-head">
        <a href="/area" style="color:white; text-decoration:none;">‚Üê Torna alla Dashboard</a>
        <span style="color:#00ffc8; font-weight:bold;">MODIFICA P{{ p_id }}</span>
    </div>

    <form method="POST" enctype="multipart/form-data" class="edit-container">
        
        <div class="edit-box">
            <h3 class="box-title">üì∏ Grafica Card</h3>
            <div class="form-grid">
                
                <div class="img-preview-box">
                    <label>Foto Agente (Apparir√† nel Cerchio)</label>
                    <img src="{{ p.foto if p.foto else 'https://via.placeholder.com/150' }}" class="circle-preview">
                    <input type="file" name="foto" accept="image/*">
                    <input type="text" name="foto_manual" placeholder="Recupero file manuale..." style="font-size:10px; margin-top:5px; padding:5px;">
                </div>

                <div class="img-preview-box">
                    <label>Logo Aziendale (Foto Copertina)</label>
                    <img src="{{ p.logo if p.logo else 'https://via.placeholder.com/300x100?text=LOGO' }}" class="rect-preview">
                    <input type="file" name="logo" accept="image/*">
                </div>

                <div class="img-preview-box full-width">
                    <label>Foto Personale (Dietro la foto agente)</label>
                    <p style="font-size:11px; color:#888;">Questa foto si vede solo se attivi l'effetto "Specchio" o "Tap" e scegli di mostrare la foto personale invece del logo.</p>
                    <img src="{{ p.personal_foto if p.personal_foto else '' }}" class="rect-preview" style="height:150px;">
                    <input type="file" name="personal_foto" accept="image/*">
                </div>
            </div>
        </div>

        <div class="edit-box" style="border-color:#0088cc;">
            <h3 class="box-title" style="color:#0088cc;">‚ú® Effetti e Movimenti</h3>
            
            <div class="form-grid">
                <div class="switch-group">
                    <label>Gira Logo (Orario):</label>
                    <input type="checkbox" name="fx_rotate_logo" {% if p.fx_rotate_logo == 'on' %}checked{% endif %}>
                </div>
                <div class="switch-group">
                    <label>Gira Agente (Orario):</label>
                    <input type="checkbox" name="fx_rotate_agent" {% if p.fx_rotate_agent == 'on' %}checked{% endif %}>
                </div>

                <div class="full-width radio-group" style="background:#222; padding:15px; border-radius:8px;">
                    <label style="color:#0088cc; display:block; margin-bottom:10px;">Tipo di Interazione (Scegline uno):</label>
                    
                    <input type="radio" name="fx_interaction" value="tap" {% if p.fx_interaction == 'tap' %}checked{% endif %}>
                    <label>TAP (Clicca per girare)</label>

                    <input type="radio" name="fx_interaction" value="mirror" {% if p.fx_interaction == 'mirror' %}checked{% endif %}>
                    <label>SPECCHIO (Gira su se stessa)</label>
                </div>

                <div class="full-width radio-group" style="background:#222; padding:15px; border-radius:8px;">
                    <label style="color:#0088cc; display:block; margin-bottom:10px;">Cosa mostrare dietro la foto Agente?</label>
                    
                    <input type="radio" name="fx_back_content" value="logo" {% if p.fx_back_content == 'logo' %}checked{% endif %}>
                    <label>Il Logo Aziendale</label>

                    <input type="radio" name="fx_back_content" value="personal" {% if p.fx_back_content == 'personal' %}checked{% endif %}>
                    <label>La Foto Personale</label>
                </div>
            </div>
        </div>

        <div class="edit-box">
            <h3 class="box-title">üë§ Dati & Business</h3>
            <div class="form-grid">
                <div class="full-width">
                    <label>Nome e Cognome</label>
                    <input type="text" name="name" value="{{ p.name }}" required>
                </div>
                <div>
                    <label>Ruolo / Qualifica</label>
                    <input type="text" name="role" value="{{ p.role }}">
                </div>
                <div>
                    <label>Azienda</label>
                    <input type="text" name="company" value="{{ p.company }}">
                </div>
                
                <div>
                    <label>P. IVA</label>
                    <input type="text" name="piva" value="{{ p.piva }}">
                </div>
                <div>
                    <label>Codice SDI</label>
                    <input type="text" name="cod_sdi" value="{{ p.cod_sdi }}">
                </div>
                <div class="full-width">
                    <label>PEC</label>
                    <input type="text" name="pec" value="{{ p.pec }}">
                </div>

                <div class="full-width">
                    <label>Bio (Italiano)</label>
                    <textarea name="bio" rows="3">{{ p.bio }}</textarea>
                </div>
            </div>
        </div>

        <div class="edit-box">
            <h3 class="box-title">üåç Traduzioni (Bio & Ruolo)</h3>
            
            <details style="margin-bottom:10px;">
                <summary style="cursor:pointer; color:#00ffc8; padding:10px; background:#222;">üá¨üáß Inglese</summary>
                <div style="padding:10px; border:1px solid #333;">
                    <label>Role (EN)</label><input type="text" name="role_en" value="{{ p.trans.en.role if p.trans else '' }}">
                    <label>Bio (EN)</label><textarea name="bio_en" rows="2">{{ p.trans.en.bio if p.trans else '' }}</textarea>
                </div>
            </details>

            <details style="margin-bottom:10px;">
                <summary style="cursor:pointer; color:#00ffc8; padding:10px; background:#222;">üá´üá∑ Francese</summary>
                <div style="padding:10px; border:1px solid #333;">
                    <label>Role (FR)</label><input type="text" name="role_fr" value="{{ p.trans.fr.role if p.trans else '' }}">
                    <label>Bio (FR)</label><textarea name="bio_fr" rows="2">{{ p.trans.fr.bio if p.trans else '' }}</textarea>
                </div>
            </details>

            <details style="margin-bottom:10px;">
                <summary style="cursor:pointer; color:#00ffc8; padding:10px; background:#222;">üá™üá∏ Spagnolo</summary>
                <div style="padding:10px; border:1px solid #333;">
                    <label>Role (ES)</label><input type="text" name="role_es" value="{{ p.trans.es.role if p.trans else '' }}">
                    <label>Bio (ES)</label><textarea name="bio_es" rows="2">{{ p.trans.es.bio if p.trans else '' }}</textarea>
                </div>
            </details>

            <details>
                <summary style="cursor:pointer; color:#00ffc8; padding:10px; background:#222;">üá©üá™ Tedesco</summary>
                <div style="padding:10px; border:1px solid #333;">
                    <label>Role (DE)</label><input type="text" name="role_de" value="{{ p.trans.de.role if p.trans else '' }}">
                    <label>Bio (DE)</label><textarea name="bio_de" rows="2">{{ p.trans.de.bio if p.trans else '' }}</textarea>
                </div>
            </details>
        </div>

        <div class="edit-box">
            <h3 class="box-title">üì± Social Network</h3>
            <p class="note" style="margin-bottom:15px;">IMPORTANTE: Inserisci sempre il link completo con <b>https://</b> (es. https://instagram.com/tuonome)</p>
            
            {% set soc_map = {} %}
            {% for s in p.socials %}{% do soc_map.update({s.label: s.url}) %}{% endfor %}

            <div class="form-grid">
                <div><label>Facebook</label><input type="text" name="facebook" value="{{ soc_map.get('Facebook','') }}"></div>
                <div><label>Instagram</label><input type="text" name="instagram" value="{{ soc_map.get('Instagram','') }}"></div>
                <div><label>LinkedIn</label><input type="text" name="linkedin" value="{{ soc_map.get('Linkedin','') }}"></div>
                <div><label>TikTok</label><input type="text" name="tiktok" value="{{ soc_map.get('TikTok','') }}"></div>
                <div><label>Spotify</label><input type="text" name="spotify" value="{{ soc_map.get('Spotify','') }}"></div>
                <div><label>Telegram</label><input type="text" name="telegram" value="{{ soc_map.get('Telegram','') }}"></div>
                <div><label>YouTube</label><input type="text" name="youtube" value="{{ soc_map.get('YouTube','') }}"></div>
            </div>
        </div>

        <div class="edit-box">
            <h3 class="box-title">üìÇ Gallerie & File</h3>
            
            <label style="color:#00ffc8;">Galleria Immagini (Max 30 totali)</label>
            <input type="file" name="gallery_img" multiple accept="image/*" style="margin-bottom:10px;">
            <div style="display:flex; flex-wrap:wrap; gap:5px;">
                {% if p.gallery_img %}
                    {% for img in p.gallery_img %}
                    <div style="position:relative;">
                        <img src="{{ img }}" style="width:60px; height:60px; object-fit:cover; border-radius:5px;">
                        <input type="checkbox" name="delete_media" value="{{ img }}" style="position:absolute; top:0; left:0;">
                    </div>
                    {% endfor %}
                {% endif %}
            </div>
            <p class="note">Spunta le foto per cancellarle e premi Salva.</p>
            <hr style="border-color:#333;">

            <label style="color:#00ffc8;">Galleria PDF (Max 12)</label>
            <input type="file" name="gallery_pdf" multiple accept=".pdf" style="margin-bottom:10px;">
            <div style="font-size:12px; color:#aaa;">
                {% if p.gallery_pdf %}
                    {% for pdf in p.gallery_pdf %}
                    <div>üìÑ {{ pdf.name }} <input type="checkbox" name="delete_media" value="{{ pdf.path }}"> (Elimina)</div>
                    {% endfor %}
                {% endif %}
            </div>
            <hr style="border-color:#333;">

            <label style="color:#00ffc8;">Galleria Video (Max 10 - Occhio al peso!)</label>
            <input type="file" name="gallery_vid" multiple accept="video/*" style="margin-bottom:10px;">
            <div style="font-size:12px; color:#aaa;">
                {% if p.gallery_vid %}
                    {% for vid in p.gallery_vid %}
                    <div>üé¨ Video Caricato <input type="checkbox" name="delete_media" value="{{ vid }}"> (Elimina)</div>
                    {% endfor %}
                {% endif %}
            </div>
        </div>

        <button type="submit" class="btn-save">üíæ SALVA TUTTO</button>
    </form>

</body>
</html>
