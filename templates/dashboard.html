<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard | Pay4You</title>
  <link rel="stylesheet" href="/static/style.css">
  <style>
    .wrap{ max-width:1100px; margin:0 auto; padding:18px; }
    .box{
      background:rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.10);
      border-radius:18px;
      padding:16px;
      margin-bottom:14px;
    }
    .title{ font-weight:900; letter-spacing:.06em; color:#00ffc8; margin:0 0 12px; text-align:center; }
    .row{ display:flex; gap:12px; justify-content:center; flex-wrap:wrap; }
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding:12px 16px; border-radius:16px;
      font-weight:900; cursor:pointer; text-decoration:none;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06); color:#fff;
      min-width:220px;
    }
    .btn-wa{ background:linear-gradient(90deg,#1ea85b,#25D366); color:#000; border:none; }
    .btn-em{ background:linear-gradient(90deg,#00a3ff,#00ffc8); color:#000; border:none; }
    .qrbox{ display:flex; justify-content:center; margin-top:10px; }
    .small{ color:#aaa; font-size:12px; text-align:center; margin-top:8px; }
  </style>
</head>
<body>

  <div class="wrap">
    <div class="box">
      <div class="row" style="justify-content:space-between;">
        <div style="font-weight:900;">Ciao, {{ user.nome }}</div>
        <a href="/area/logout" style="color:#ff5555; font-weight:900; text-decoration:none;">Esci</a>
      </div>
    </div>

    <div class="box">
      <div class="title">IMPOSTAZIONE CARTA / QR</div>

      <div class="qrbox">
        <img src="https://api.qrserver.com/v1/create-qr-code/?size=260x260&data={{ request.url_root.rstrip('/') }}/card/{{ user.slug }}"
             style="background:white; padding:14px; border-radius:18px;">
      </div>

      <div class="row" style="margin-top:14px;">
        <div class="btn btn-wa" onclick="sendWA()">üì≤ INVIA SU WHATSAPP</div>
        <div class="btn btn-em" onclick="sendEmail()">‚úâÔ∏è INVIA PER EMAIL</div>
      </div>

      <div class="small">
        ‚úÖ L‚Äôimpostazione carta serve per definire quale profilo viene aperto per primo quando qualcuno usa NFC/QR.
        In base al profilo selezionato, quello sar√† il primo che la persona vede.
      </div>
    </div>

    <div class="box">
      <div class="title">GESTIONE PROFILI</div>

      <div class="row" style="justify-content:space-between;">
        <div style="font-weight:900;">P1</div>
        <div class="row">
          <a class="btn" style="min-width:180px;" href="/area/edit/1">MODIFICA CARD</a>
        </div>
      </div>

      <div class="row" style="justify-content:space-between; margin-top:10px;">
        <div style="font-weight:900;">P2</div>
        <div class="row">
          {% if user.p2.active %}
            <a class="btn" style="min-width:180px;" href="/card/{{ user.slug }}?p=p2" target="_blank">APRI CARD</a>
            <a class="btn" style="min-width:180px;" href="/area/edit/2">MODIFICA CARD</a>
            <a class="btn" style="min-width:180px; background:#c70000; border:none;" href="/area/deactivate/2" onclick="return confirm('Disattivare P2?')">DISATTIVA CARD</a>
          {% else %}
            <a class="btn" style="min-width:180px;" href="/area/activate/2">ATTIVA CARD</a>
          {% endif %}
        </div>
      </div>

      <div class="row" style="justify-content:space-between; margin-top:10px;">
        <div style="font-weight:900;">P3</div>
        <div class="row">
          {% if user.p3.active %}
            <a class="btn" style="min-width:180px;" href="/card/{{ user.slug }}?p=p3" target="_blank">APRI CARD</a>
            <a class="btn" style="min-width:180px;" href="/area/edit/3">MODIFICA CARD</a>
            <a class="btn" style="min-width:180px; background:#c70000; border:none;" href="/area/deactivate/3" onclick="return confirm('Disattivare P3?')">DISATTIVA CARD</a>
          {% else %}
            <a class="btn" style="min-width:180px;" href="/area/activate/3">ATTIVA CARD</a>
          {% endif %}
        </div>
      </div>

      <div class="small">
        Nota: P1 non √® eliminabile.
      </div>
    </div>
  </div>

  <script>
    function makeMailto(subject, body){
      const b = (body || "").replace(/\n/g, "\r\n");
      return "mailto:?subject=" + encodeURIComponent(subject) + "&body=" + encodeURIComponent(b);
    }

    function sendWA(){
      const base = window.location.origin;
      const login = base + "/area/login";
      const card = base + "/card/{{ user.slug }}";

      const txt =
        "Pay4You - Accesso Dashboard\n\n" +
        "Login: " + login + "\n" +
        "User: {{ user.username }}\n" +
        "Pass: {{ user.password }}\n\n" +
        "Card: " + card;

      window.open("https://wa.me/?text=" + encodeURIComponent(txt), "_blank");
    }

    function sendEmail(){
      const base = window.location.origin;
      const login = base + "/area/login";
      const card = base + "/card/{{ user.slug }}";

      const subject = "Pay4You - Credenziali Accesso";
      const body =
        "Ciao!\n\n" +
        "Ecco le tue credenziali Pay4You per gestire la Card:\n\n" +
        "LOGIN: " + login + "\n" +
        "USER: {{ user.username }}\n" +
        "PASSWORD: {{ user.password }}\n\n" +
        "La tua Card:\n" + card + "\n\n" +
        "‚Äî Pay4You";

      window.location.href = makeMailto(subject, body);
    }
  </script>

</body>
</html>
