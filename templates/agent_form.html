{% extends "base.html" %}
{% block title %}{{ ag.name }}{% endblock %}

{% block content %}
<div class="card-wrapper">

  <!-- HEADER -->
  <header class="p4y-header">
    <div class="p4y-logo">Pay4You</div>
  </header>

  <!-- FOTO + NOME -->
  <section class="p4y-profile">
    {% if ag.photo_url %}
      <img src="{{ ag.photo_url }}" alt="Foto profilo" class="p4y-photo">
    {% else %}
      <img src="{{ url_for('static', filename='logo.png') }}" class="p4y-photo" alt="profile">
    {% endif %}
    <h1 class="p4y-name">{{ ag.name }}</h1>
    {% if ag.role %}<p class="p4y-role">{{ ag.role }}</p>{% endif %}
    {% if ag.company %}<p class="p4y-company">{{ ag.company }}</p>{% endif %}
  </section>

  <!-- BIO -->
  {% if ag.bio %}
  <section class="p4y-section">
    <p class="p4y-bio">{{ ag.bio }}</p>
  </section>
  {% endif %}

  <!-- CONTATTI -->
  <section class="p4y-section">
    <h3>ğŸ“ Contatti</h3>

    {% if ag.phone_mobile %}
      <a href="tel:{{ ag.phone_mobile }}" class="p4y-btn">ğŸ“± Chiama mobile<br><strong>{{ ag.phone_mobile }}</strong></a>
    {% endif %}

    {% if ag.phone_office %}
      <a href="tel:{{ ag.phone_office }}" class="p4y-btn">â˜ï¸ Chiama ufficio<br><strong>{{ ag.phone_office }}</strong></a>
    {% endif %}

    {% if ag.whatsapp %}
      <a href="https://wa.me/{{ ag.whatsapp | replace(' ', '') }}" class="p4y-btn" target="_blank" rel="noopener">ğŸŸ¢ WhatsApp<br><strong>{{ ag.whatsapp }}</strong></a>
    {% endif %}

    {% for email in emails %}
      <a href="mailto:{{ email }}" class="p4y-btn">ğŸ“§ Email<br><strong>{{ email }}</strong></a>
    {% endfor %}

    {% if ag.pec %}
      <a href="mailto:{{ ag.pec }}" class="p4y-btn">ğŸ“® PEC<br><strong>{{ ag.pec }}</strong></a>
    {% endif %}

    {% for site in websites %}
      <a href="{{ site }}?card={{ ag.slug }}" class="p4y-btn" target="_blank" rel="noopener">
        ğŸŒ Sito internet<br><strong>Vai al sito</strong>
      </a>
    {% endfor %}
  </section>

  <!-- SOCIAL -->
  <section class="p4y-section">
    <h3>ğŸ“£ Social</h3>
    {% if ag.facebook %}<a href="{{ ag.facebook }}" class="p4y-btn" target="_blank" rel="noopener">ğŸ“˜ Facebook<br><strong>Profilo</strong></a>{% endif %}
    {% if ag.instagram %}<a href="{{ ag.instagram }}" class="p4y-btn" target="_blank" rel="noopener">ğŸ“· Instagram<br><strong>Profilo</strong></a>{% endif %}
    {% if ag.linkedin %}<a href="{{ ag.linkedin }}" class="p4y-btn" target="_blank" rel="noopener">ğŸ’¼ LinkedIn<br><strong>Profilo</strong></a>{% endif %}
  </section>

  <!-- AZIONI -->
  <section class="p4y-section">
    <h3>ğŸªª Profilo digitale</h3>
    <a href="{{ url_for('card', slug=ag.slug) }}" class="p4y-btn">ğŸ”³ Apri card</a>
    <a href="{{ url_for('download_vcf', agent_id=ag.id) }}" class="p4y-btn">ğŸ’¾ Salva contatto</a>
    <a href="{{ url_for('qrcode', slug=ag.slug) }}" class="p4y-btn">ğŸ”³ QR code</a>
  </section>

  <!-- DATI FISCALI -->
  {% if ag.piva or ag.sdi or ag.iban %}
  <section class="p4y-section">
    <h3>ğŸ›ï¸ Dati fiscali</h3>

    {% if ag.piva %}
      <div class="p4y-fiscal-row">ğŸ  Partita IVA <strong>{{ ag.piva }}</strong></div>
    {% endif %}

    {% if ag.sdi %}
      <div class="p4y-fiscal-row">ğŸ“¨ Codice SDI <strong>{{ ag.sdi }}</strong></div>
    {% endif %}

    {% if ag.iban %}
      <div class="p4y-fiscal-row">
        ğŸ¦ IBAN <strong id="iban-text">{{ ag.iban }}</strong>
      </div>
      <button type="button" class="copy-iban-btn" data-iban="{{ ag.iban }}" id="copyIbanBtn">ğŸ“‹ Copia IBAN</button>
    {% endif %}

  </section>
  {% endif %}

  <!-- INDIRIZZI -->
  {% if addresses %}
  <section class="p4y-section">
    <h3>ğŸ“ Indirizzi</h3>
    {% for addr in addresses %}
      <div class="p4y-fiscal-row">{{ addr }}</div>
    {% endfor %}
  </section>
  {% endif %}

  <!-- PDF -->
  {% if pdfs %}
  <section class="p4y-section">
    <h3>ğŸ“„ Documenti</h3>
    {% for pdf_url in pdfs %}
      <a href="{{ pdf_url }}" class="p4y-btn" target="_blank" rel="noopener">ğŸ“„ Documento {{ loop.index }}</a>
    {% endfor %}
  </section>
  {% endif %}

  <!-- GALLERY -->
  {% if gallery %}
  <section class="p4y-section">
    <h3>ğŸ–¼ï¸ Galleria foto</h3>
    {% for img in gallery %}
      <img src="{{ img }}" class="p4y-gallery-img" alt="Foto Pay4You">
    {% endfor %}
  </section>
  {% endif %}

  <footer class="p4y-footer">Pay4You â€“ Card digitale personale</footer>

</div>

<!-- SCRIPT COPIA IBAN -->
<script>
document.addEventListener("DOMContentLoaded", function() {
  const btn = document.getElementById("copyIbanBtn");
  if (!btn) return;
  btn.addEventListener("click", function() {
    const iban = this.getAttribute("data-iban");
    navigator.clipboard.writeText(iban).then(() => {
      this.innerText = "âœ” IBAN copiato";
      setTimeout(() => { this.innerText = "ğŸ“‹ Copia IBAN"; }, 1500);
    });
  });
});
</script>
{% endblock %}
