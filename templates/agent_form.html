{% extends "base.html" %}
{% block title %}{% if agent %}Modifica{% else %}Nuovo{% endif %} | Pay4You{% endblock %}

{% block content %}
<div class="page-main">
  <div class="agent-form-wrapper">

    <h1 class="agent-form-title">
      {% if agent %}Modifica: {{ agent.name }}{% else %}Nuovo profilo{% endif %}
    </h1>

    {% if session.get('role') != 'admin' and agent %}
      <div class="profile-tools">
        <a class="header-link" href="{{ url_for('me_profile2') }}">ðŸ‘¤ Profilo 2 (multi-utente)</a>
        <a class="header-link" href="/{{ agent.slug }}?p=p2" target="_blank" rel="noopener">Apri Profilo 2 pubblico</a>
        <a class="header-link" href="/{{ agent.slug }}" target="_blank" rel="noopener">Apri Card pubblica</a>
      </div>
    {% endif %}

    {% if session.get('role') == 'admin' %}
      {% if agent %}
        {% set form_action = url_for('update_agent', slug=agent.slug) %}
      {% else %}
        {% set form_action = url_for('create_agent') %}
      {% endif %}
    {% else %}
      {% set form_action = url_for('me_edit_post') %}
    {% endif %}

    <form class="agent-form" method="post" action="{{ form_action }}" enctype="multipart/form-data">

      {% if session.get('role') == 'admin' %}
        <label>Slug (univoco)</label>
        <input type="text" name="slug" value="{{ agent.slug if agent else '' }}" required>

        <label>Piano</label>
        <select name="plan" class="input-like">
          {% set p = (agent.plan if agent and agent.plan else 'basic') %}
          <option value="basic" {% if p=='basic' %}selected{% endif %}>basic</option>
          <option value="pro" {% if p=='pro' %}selected{% endif %}>pro</option>
        </select>
      {% else %}
        {% if agent %}
          <div class="slug-badge">Slug: <b>{{ agent.slug }}</b></div>
        {% endif %}
      {% endif %}

      <label>Nome</label>
      <input type="text" name="name" value="{{ agent.name if agent else '' }}" required>

      <label>Azienda</label>
      <input type="text" name="company" value="{{ agent.company if agent else '' }}">

      <label>Ruolo</label>
      <input type="text" name="role" value="{{ agent.role if agent else '' }}">

      <label>Bio / Descrizione</label>
      <textarea name="bio">{{ agent.bio if agent else '' }}</textarea>

      <hr class="sep">

      <label>Telefono mobile</label>
      <input type="text" name="phone_mobile" value="{{ agent.phone_mobile if agent else '' }}">

      <label>Telefono mobile 2</label>
      <input type="text" name="phone_mobile2" value="{{ agent.phone_mobile2 if agent else '' }}">

      <label>Telefono ufficio</label>
      <input type="text" name="phone_office" value="{{ agent.phone_office if agent else '' }}">

      <label>WhatsApp (numero o link)</label>
      <input type="text" name="whatsapp" value="{{ agent.whatsapp if agent else '' }}">

      <label>Email (separate da virgola)</label>
      <input type="text" name="emails" value="{{ agent.emails if agent else '' }}">

      <label>Siti web (separati da virgola)</label>
      <input type="text" name="websites" value="{{ agent.websites if agent else '' }}">

      <label>PEC</label>
      <input type="text" name="pec" value="{{ agent.pec if agent else '' }}">

      <label>P.IVA</label>
      <input type="text" name="piva" value="{{ agent.piva if agent else '' }}">

      <label>SDI</label>
      <input type="text" name="sdi" value="{{ agent.sdi if agent else '' }}">

      <label>Indirizzi (uno per riga)</label>
      <textarea name="addresses">{{ agent.addresses if agent else '' }}</textarea>

      <hr class="sep">

      <label>Facebook</label>
      <input type="text" name="facebook" value="{{ agent.facebook if agent else '' }}">

      <label>Instagram</label>
      <input type="text" name="instagram" value="{{ agent.instagram if agent else '' }}">

      <label>LinkedIn</label>
      <input type="text" name="linkedin" value="{{ agent.linkedin if agent else '' }}">

      <label>TikTok</label>
      <input type="text" name="tiktok" value="{{ agent.tiktok if agent else '' }}">

      <label>Telegram</label>
      <input type="text" name="telegram" value="{{ agent.telegram if agent else '' }}">

      <hr class="sep">

      <label>Foto profilo</label>
      <input type="file" name="photo" accept="image/*">

      <label>Logo (in alto a sinistra + retro foto)</label>
      <input type="file" name="extra_logo" accept="image/*">

      <label>Galleria (max 30 immagini)</label>
      <input type="file" name="gallery" accept="image/*" multiple>

      <label>Video (max 10)</label>
      <input type="file" name="videos" accept="video/*" multiple>

      <label>PDF (fino a 12)</label>
      <input type="file" name="pdf1" accept="application/pdf">
      <input type="file" name="pdf2" accept="application/pdf">
      <input type="file" name="pdf3" accept="application/pdf">
      <input type="file" name="pdf4" accept="application/pdf">
      <input type="file" name="pdf5" accept="application/pdf">
      <input type="file" name="pdf6" accept="application/pdf">
      <input type="file" name="pdf7" accept="application/pdf">
      <input type="file" name="pdf8" accept="application/pdf">
      <input type="file" name="pdf9" accept="application/pdf">
      <input type="file" name="pdf10" accept="application/pdf">
      <input type="file" name="pdf11" accept="application/pdf">
      <input type="file" name="pdf12" accept="application/pdf">

      <!-- âœ… Non mostriamo piÃ¹ il box JSON come unico modo.
           Se vuoi tenerlo â€œper adminâ€, lo possiamo rimettere solo admin.
           Per ora: niente JSON allâ€™utente base. -->

      <div class="agent-form-buttons">
        <button type="submit">Salva</button>

        {% if session.get('role') == 'admin' %}
          <a class="btn-secondary" href="{{ url_for('admin_home') }}">Torna alla lista</a>
        {% else %}
          <a class="btn-secondary" href="{{ url_for('logout') }}">Logout</a>
        {% endif %}
      </div>

    </form>
  </div>
</div>
{% endblock %}
