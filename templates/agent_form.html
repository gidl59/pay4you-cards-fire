<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ "Modifica Profilo 2" if editing_profile2 else "Modifica Profilo 1" }} | Pay4You</title>
  <link rel="icon" href="/favicon.ico">
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<div class="app-shell">

  <header class="app-header">
    <a class="brand" href="/area">
      <div class="logo-dot"></div>
      <div>
        <div class="brand-title">Pay4You Cards</div>
        <div class="hint">{{ "Profilo 2" if editing_profile2 else "Profilo 1" }}</div>
      </div>
    </a>

    <div class="toolbar">
      <a class="btn" href="/area">← Dashboard</a>
      <a class="btn danger" href="/area/logout">Logout</a>
    </div>
  </header>

  <main class="app-main">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-wrap">
          {% for cat,msg in messages %}
            <div class="flash flash-{{cat}}">{{ msg }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <div class="page-main">
      <div class="panel panel-wide">

        <div class="panel-head">
          <div>
            <h1 class="page-title">{{ "Modifica Profilo 2" if editing_profile2 else "Modifica Profilo 1" }}</h1>
            <div class="hint">
              {% if editing_profile2 %}
                Questo è il Profilo 2 (se attivo). Può essere completamente diverso dal Profilo 1.
              {% else %}
                Qui modifichi i dati principali della tua Pay4You Card.
              {% endif %}
            </div>
          </div>
          <div class="toolbar">
            {% if agent %}
              <a class="btn-mini ghost" target="_blank" href="/{{ agent.slug }}">Apri P1</a>
              {% if agent.p2_enabled == 1 %}
                <a class="btn-mini ghost" target="_blank" href="/{{ agent.slug }}?p=p2">Apri P2</a>
              {% endif %}
            {% endif %}
          </div>
        </div>

        <div class="sep"></div>

        <form method="post" enctype="multipart/form-data" class="card-form">

          {% if agent %}
          <div class="section-box">
            <div class="h3">Identificativo</div>
            <div class="form-grid">
              <div class="field">
                <label>Slug (non modificabile)</label>
                <input type="text" value="{{ agent.slug }}" readonly>
                <div class="hint">È il link pubblico della card.</div>
              </div>
              <div class="field">
                <label>Link card</label>
                <input type="text" value="{{ base_url ~ '/' ~ agent.slug if base_url else ('/' ~ agent.slug) }}" readonly>
              </div>
            </div>
          </div>
          {% endif %}

          <div class="section-box">
            <div class="h3">Dati principali</div>
            <div class="form-grid">
              <div class="field">
                <label>Nome</label>
                <input type="text" name="name" value="{{ agent.name if agent else '' }}">
              </div>
              <div class="field">
                <label>Azienda</label>
                <input type="text" name="company" value="{{ agent.company if agent else '' }}">
              </div>
              <div class="field">
                <label>Ruolo</label>
                <input type="text" name="role" value="{{ agent.role if agent else '' }}">
              </div>
              <div class="field">
                <label>Bio</label>
                <textarea name="bio" placeholder="Breve descrizione...">{{ agent.bio if agent else '' }}</textarea>
              </div>
            </div>
          </div>

          <div class="section-box">
            <div class="h3">Contatti</div>
            <div class="form-grid">
              <div class="field">
                <label>Cellulare</label>
                <input type="text" name="phone_mobile" value="{{ agent.phone_mobile if agent else '' }}">
              </div>
              <div class="field">
                <label>Cellulare 2</label>
                <input type="text" name="phone_mobile2" value="{{ agent.phone_mobile2 if agent else '' }}">
              </div>
              <div class="field">
                <label>Ufficio</label>
                <input type="text" name="phone_office" value="{{ agent.phone_office if agent else '' }}">
              </div>
              <div class="field">
                <label>WhatsApp</label>
                <input type="text" name="whatsapp" value="{{ agent.whatsapp if agent else '' }}">
              </div>
              <div class="field full">
                <label>Email (separate da virgola)</label>
                <input type="text" name="emails" value="{{ agent.emails if agent else '' }}">
              </div>
              <div class="field full">
                <label>Siti web (separati da virgola)</label>
                <input type="text" name="websites" value="{{ agent.websites if agent else '' }}">
              </div>
              <div class="field">
                <label>PEC</label>
                <input type="text" name="pec" value="{{ agent.pec if agent else '' }}">
              </div>
              <div class="field full">
                <label>Indirizzi (uno per riga)</label>
                <textarea name="addresses">{{ agent.addresses if agent else '' }}</textarea>
              </div>
            </div>
          </div>

          <div class="section-box">
            <div class="h3">Dati fiscali</div>
            <div class="form-grid">
              <div class="field">
                <label>P.IVA</label>
                <input type="text" name="piva" value="{{ agent.piva if agent else '' }}">
              </div>
              <div class="field">
                <label>SDI</label>
                <input type="text" name="sdi" value="{{ agent.sdi if agent else '' }}">
              </div>
            </div>
          </div>

          {% if not editing_profile2 %}
          <div class="section-box">
            <div class="h3">Media</div>
            <div class="form-grid">
              <div class="field">
                <label>Foto profilo</label>
                <input type="file" name="photo" accept="image/*">
              </div>
              <div class="field">
                <label>Logo</label>
                <input type="file" name="logo" accept="image/*">
              </div>
              <div class="field full">
                <label>Background (immagine)</label>
                <input type="file" name="back_media" accept="image/*">
              </div>
              <div class="field full">
                <label>Galleria (multipla)</label>
                <input type="file" name="gallery" accept="image/*" multiple>
              </div>
              <div class="field full">
                <label>Video (multipli)</label>
                <input type="file" name="videos" accept="video/*" multiple>
              </div>

              <div class="field full">
                <label>PDF (fino a {{ 12 }})</label>
                <div class="hint">Carica nei campi sottostanti: ogni upload sostituisce lo “slot”.</div>
                <div class="grid-3">
                  {% for i in range(1, 13) %}
                    <div class="field">
                      <label>PDF {{ i }}</label>
                      <input type="file" name="pdf{{ i }}" accept="application/pdf">
                    </div>
                  {% endfor %}
                </div>
              </div>
            </div>
          </div>
          {% endif %}

          <div class="sticky-save">
            <button class="btn primary" type="submit">Salva</button>
            <a class="btn" href="/area">Annulla</a>
          </div>

        </form>
      </div>
    </div>

  </main>

</div>
</body>
</html>
