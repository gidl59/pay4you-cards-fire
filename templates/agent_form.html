{% extends "base.html" %}
{% block title %}Modifica | Pay4You{% endblock %}

{% block content %}
<div class="page-main">
  <div class="panel">

    <div class="panel-head">
      <h1 class="page-title">
        {% if editing_profile2 %}Modifica: Profilo 2{% else %}Modifica: Profilo 1{% endif %}
      </h1>

      {% if session.get('role') != 'admin' and agent %}
      <div class="toolbar">
        <a class="btn ghost" href="{{ url_for('me_edit') }}">Profilo 1</a>
        <a class="btn ghost" href="{{ url_for('me_profile2') }}">Profilo 2</a>
        <a class="btn" href="/{{ agent.slug }}" target="_blank" rel="noopener">Apri Card (P1)</a>
        <a class="btn" href="/{{ agent.slug }}?p=p2" target="_blank" rel="noopener">Apri Card (P2)</a>
      </div>
      {% endif %}
    </div>

    {% if session.get('role') == 'admin' %}
      {% if agent %}
        {% set form_action = url_for('update_agent', slug=agent.slug) %}
      {% else %}
        {% set form_action = url_for('create_agent') %}
      {% endif %}
    {% else %}
      {% if editing_profile2 %}
        {% set form_action = url_for('me_profile2_post') %}
      {% else %}
        {% set form_action = url_for('me_edit_post') %}
      {% endif %}
    {% endif %}

    <form method="post" action="{{ form_action }}" enctype="multipart/form-data">

      <div class="form-grid">
        {% if session.get('role') == 'admin' %}
          <div class="field">
            <label>Slug (univoco)</label>
            <input type="text" name="slug" value="{{ agent.slug if agent else '' }}" required>
          </div>
        {% else %}
          <div class="field">
            <label>Slug</label>
            <input type="text" value="{{ agent.slug }}" disabled>
          </div>
        {% endif %}

        <div class="field">
          <label>Nome</label>
          <input type="text" name="name" value="{{ agent.name or '' }}" required>
        </div>

        <div class="field">
          <label>Azienda</label>
          <input type="text" name="company" value="{{ agent.company or '' }}">
        </div>

        <div class="field">
          <label>Ruolo</label>
          <input type="text" name="role" value="{{ agent.role or '' }}">
        </div>

        <div class="field full">
          <label>Bio / Descrizione</label>
          <textarea name="bio">{{ agent.bio or '' }}</textarea>
        </div>

        <div class="field full"><div class="sep"></div></div>

        <div class="field">
          <label>Telefono mobile</label>
          <input type="text" name="phone_mobile" value="{{ agent.phone_mobile or '' }}">
        </div>
        <div class="field">
          <label>Telefono mobile 2</label>
          <input type="text" name="phone_mobile2" value="{{ agent.phone_mobile2 or '' }}">
        </div>
        <div class="field">
          <label>Telefono ufficio</label>
          <input type="text" name="phone_office" value="{{ agent.phone_office or '' }}">
        </div>
        <div class="field">
          <label>WhatsApp (numero o link)</label>
          <input type="text" name="whatsapp" value="{{ agent.whatsapp or '' }}">
        </div>

        <div class="field full">
          <label>Email (separate da virgola)</label>
          <input type="text" name="emails" value="{{ agent.emails or '' }}">
        </div>

        <div class="field full">
          <label>Siti web (separati da virgola)</label>
          <input type="text" name="websites" value="{{ agent.websites or '' }}">
        </div>

        <div class="field">
          <label>PEC</label>
          <input type="text" name="pec" value="{{ agent.pec or '' }}">
        </div>
        <div class="field">
          <label>P.IVA</label>
          <input type="text" name="piva" value="{{ agent.piva or '' }}">
        </div>
        <div class="field">
          <label>SDI</label>
          <input type="text" name="sdi" value="{{ agent.sdi or '' }}">
        </div>

        <div class="field full">
          <label>Indirizzi (uno per riga)</label>
          <textarea name="addresses">{{ agent.addresses or '' }}</textarea>
        </div>

        <div class="field full"><div class="sep"></div></div>

        <div class="field">
          <label>Facebook (link completo)</label>
          <input type="text" name="facebook" value="{{ agent.facebook or '' }}">
        </div>
        <div class="field">
          <label>Instagram (link completo)</label>
          <input type="text" name="instagram" value="{{ agent.instagram or '' }}">
        </div>
        <div class="field">
          <label>LinkedIn (link completo)</label>
          <input type="text" name="linkedin" value="{{ agent.linkedin or '' }}">
        </div>
        <div class="field">
          <label>TikTok (link completo)</label>
          <input type="text" name="tiktok" value="{{ agent.tiktok or '' }}">
        </div>
        <div class="field">
          <label>Telegram (link o @user)</label>
          <input type="text" name="telegram" value="{{ agent.telegram or '' }}">
        </div>

        <div class="field full"><div class="sep"></div></div>

        <div class="field">
          <label>Foto profilo (max 8MB)</label>
          <input type="file" name="photo" accept="image/*">
        </div>
        <div class="field">
          <label>Logo (max 8MB)</label>
          <input type="file" name="logo" accept="image/*">
        </div>

        {% if not editing_profile2 %}
          <div class="field full">
            <label>Galleria (max 30 immagini, 8MB cad.)</label>
            <input type="file" name="gallery" accept="image/*" multiple>
          </div>

          <div class="field full">
            <label>Video (max 10, 60MB cad.)</label>
            <input type="file" name="videos" accept="video/*" multiple>
          </div>

          <div class="field full">
            <label>PDF (fino a 12, 15MB cad.)</label>
            <div class="grid-3">
              {% for i in range(1,13) %}
                <input type="file" name="pdf{{i}}" accept="application/pdf">
              {% endfor %}
            </div>
          </div>
        {% endif %}

        <div class="field full">
          <div class="toolbar">
            <button class="btn primary" type="submit">Salva</button>
            {% if session.get('role') == 'admin' %}
              <a class="btn ghost" href="{{ url_for('dashboard') }}">Torna alla lista</a>
            {% else %}
              <a class="btn ghost" href="{{ url_for('logout') }}">Logout</a>
            {% endif %}
          </div>
        </div>
      </div>

    </form>

    <div class="footer">
      Realizzato Â© Pay4You da Giuseppe Di Lisio 2026
    </div>

  </div>
</div>
{% endblock %}
