<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Master Control</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        body { background:#050505; color:white; font-family:sans-serif; padding:20px; }
        .box { background:#111; padding:20px; border-radius:10px; margin-bottom:20px; border:1px solid #333; }
        table { width:100%; border-collapse:collapse; }
        td, th { padding:10px; border-bottom:1px solid #222; text-align:left; }
        .btn { padding:5px 10px; border-radius:5px; text-decoration:none; cursor:pointer; font-size:12px; border:none; color:white; margin-right:5px; }
        .btn-wa { background:#25D366; } .btn-mail { background:#fff; color:black; }
        .btn-del { background:#cc0000; } .btn-view { background:#0088cc; }
        input { background:#222; border:1px solid #444; color:white; padding:8px; border-radius:5px; }
    </style>
</head>
<body>
    <h1>MASTER CONTROL</h1>
    
    <div class="box">
        <h3>➕ Nuovo Cliente</h3>
        <form action="/master/add" method="POST">
            <input type="text" name="slug" placeholder="Slug (es. mario)" required>
            <input type="text" name="username" placeholder="User">
            <input type="text" name="password" placeholder="Pass (vuoto=auto)">
            <input type="text" name="nome" placeholder="Nome">
            <button class="btn btn-wa" style="font-size:14px;">CREA</button>
        </form>
    </div>

    <div class="box">
        <table>
            <tr><th>Cliente</th><th>Credenziali</th><th>Invia</th><th>Azioni</th></tr>
            {% for c in clienti %}
            <tr>
                <td>{{ c.nome }}<br><small style="color:#00ffc8;">/card/{{ c.slug }}</small></td>
                <td style="font-family:monospace;">U: {{ c.username }}<br>P: {{ c.password }}</td>
                <td>
                    <button onclick="sendWa('{{c.username}}','{{c.password}}')" class="btn btn-wa">WA</button>
                    <button onclick="sendMail('{{c.username}}','{{c.password}}')" class="btn btn-mail">@</button>
                </td>
                <td>
                    <a href="/master/impersonate/{{c.id}}" target="_blank" class="btn btn-view">Gestisci</a>
                    <a href="/master/delete/{{c.id}}" class="btn btn-del" onclick="return confirm('Eliminare?')">X</a>
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <script>
        function sendWa(u, p) {
            var txt = "Credenziali Pay4You:\nUser: " + u + "\nPass: " + p + "\nLogin: https://pay4you-cards-fire.onrender.com/area/login";
            window.open("https://wa.me/?text=" + encodeURIComponent(txt));
        }
        function sendMail(u, p) {
            var email = "";
            var subject = "Credenziali Pay4You";
            var body = "Ecco le tue credenziali:\n\nUser: " + u + "\nPassword: " + p + "\n\nLogin qui: https://pay4you-cards-fire.onrender.com/area/login";
            // Usa window.open con _self per compatibilità massima
            window.open("mailto:" + email + "?subject=" + encodeURIComponent(subject) + "&body=" + encodeURIComponent(body), "_self");
        }
    </script>
</body>
</html>
