<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Master Control</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico?v=2">
    <link rel="stylesheet" href="/static/style.css">
    <style>
        .admin-box { background:#111; padding:20px; border-radius:15px; border:1px solid #333; margin-bottom:20px; }
        .file-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap:10px; margin-top:15px; }
        .file-item { background:#222; padding:5px; border-radius:5px; text-align:center; font-size:10px; color:#aaa; overflow:hidden;}
        .file-item img { width:100%; height:80px; object-fit:cover; border-radius:4px; margin-bottom:5px; }
        .btn-mini { padding: 5px 10px; border-radius: 4px; border: none; cursor: pointer; color: white; text-decoration: none; font-size:11px;}
        .bg-blue { background: #0088cc; }
        .bg-red { background: #cc0000; }
        .bg-green { background: #00ffc8; color:black; }
    </style>
</head>
<body style="background:#050505; padding:20px; font-family:sans-serif; color:white;">

    <div class="dash-container">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <h1 style="color:#ff4444; margin:0;">MASTER ROOM</h1>
            <a href="/master/logout" style="color:white;">Esci</a>
        </div>

        <div class="admin-box" style="border-color:#0088cc;">
            <h3 style="color:#0088cc; margin:0;">üìÇ File Trovati sul Disco ({{ files|length }})</h3>
            <p style="font-size:12px; color:#888;">Questi sono i file salvati dalla vecchia versione. Copia il percorso e incollalo nel profilo.</p>
            
            <div class="file-grid">
                {% for f in files %}
                <div class="file-item">
                    <a href="/uploads/{{ f }}" target="_blank">
                        <img src="/uploads/{{ f }}" onerror="this.src='https://via.placeholder.com/80?text=FILE'">
                    </a>
                    <div style="margin-bottom:5px;">{{ f }}</div>
                    <button class="btn-mini bg-blue" onclick="copiaPercorso('/uploads/{{ f }}')">Copia Link</button>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="admin-box">
            <h3>‚ûï Nuovo Cliente</h3>
            <form action="/master/add" method="POST" style="display:grid; grid-template-columns: 1fr 1fr 1fr 1fr auto; gap:10px;">
                <input type="text" name="nome" placeholder="Nome" style="padding:8px; background:#222; border:1px solid #444; color:white;" required>
                <input type="text" name="username" placeholder="User" style="padding:8px; background:#222; border:1px solid #444; color:white;" required>
                <input type="text" name="password" placeholder="Pass" style="padding:8px; background:#222; border:1px solid #444; color:white;" required>
                <input type="text" name="slug" placeholder="Slug (es. mario)" style="padding:8px; background:#222; border:1px solid #444; color:white;" required>
                <button type="submit" class="btn-mini bg-green" style="padding:10px;">CREA</button>
            </form>
        </div>

        <div class="admin-box">
            <h3>Utenti Attivi</h3>
            <table style="width:100%; text-align:left; font-size:14px;">
                {% for c in clienti %}
                <tr>
                    <td style="padding:10px;">#{{ c.id }} <strong>{{ c.nome }}</strong></td>
                    <td>{{ c.username }}</td>
                    <td><a href="/card/{{ c.slug }}" target="_blank" style="color:#00ffc8;">/{{ c.slug }}</a></td>
                    <td>
                        <a href="/master/impersonate/{{ c.id }}" target="_blank" class="btn-mini bg-blue">üëÅÔ∏è Gestisci</a>
                        {% if c.id != 1 %}<a href="/master/delete/{{ c.id }}" class="btn-mini bg-red">üóëÔ∏è</a>{% endif %}
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>

    </div>

    <script>
        function copiaPercorso(testo) {
            navigator.clipboard.writeText(testo);
            alert("Percorso copiato: " + testo + "\nOra incollalo nel campo 'Foto Manuale' del profilo!");
        }
    </script>
</body>
</html>
