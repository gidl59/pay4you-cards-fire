{% extends "base.html" %}
{% block title %}Condividi | Pay4You{% endblock %}

{% block content %}
<div class="panel panel-wide">
  <div class="panel-head" style="align-items:center;">
    <div>
      <h1 class="page-title" style="margin-bottom:4px;">Condivisione</h1>
      <div class="hint">Se WhatsApp non si apre da solo, premi “Apri WhatsApp”.</div>
    </div>

    <div class="btn-row">
      <a class="btn-mini ghost" href="{{ back or url_for('dashboard') }}">← Torna alla card</a>
      <a class="btn-mini" id="btnOpen" href="#" rel="noopener">Apri WhatsApp</a>
    </div>
  </div>

  <div class="sep" style="margin:12px 0;"></div>

  <div class="section" style="margin-top:0;">
    <div class="section-title">Testo da inviare</div>
    <div class="row" style="justify-content:flex-start;">
      <div style="width:100%; white-space:pre-wrap; line-height:1.35;">{{ text }}</div>
    </div>
  </div>
</div>

<script>
  (function(){
    const t = {{ text|tojson }};
    const wa = "https://wa.me/?text=" + encodeURIComponent(t);
    const btn = document.getElementById("btnOpen");
    if(btn) btn.href = wa;

    // ✅ auto-apertura con fallback
    setTimeout(()=>{ window.location.href = wa; }, 250);
  })();
</script>
{% endblock %}
