{% extends "base.html" %}
{% block title %}Condividi | Pay4You{% endblock %}

{% block content %}
<div class="out-shell">
  <div class="out-head">
    <div class="out-title">Condivisione WhatsApp</div>
    <a class="btn-mini ghost" href="{{ back or '/' }}">← Torna alla card</a>
  </div>

  <div class="out-box">
    <div style="font-weight:950; margin-bottom:8px;">Messaggio da inviare</div>
    <textarea class="out-textarea" readonly>{{ text }}</textarea>

    <div class="out-actions">
      <a class="btn primary" href="{{ wa_url }}" rel="noopener">Apri WhatsApp</a>
      <button class="btn ghost" type="button" onclick="copyText()">Copia testo</button>
      <a class="btn ghost" href="{{ back or '/' }}">Torna alla card</a>
    </div>

    <div style="margin-top:10px; color:rgba(255,255,255,.72); font-weight:800; font-size:13px;">
      Se WhatsApp non si apre automaticamente, premi <b>Apri WhatsApp</b>.
    </div>
  </div>

  <div class="footer">© 2026 Pay4You — Giuseppe Di Lisio</div>
</div>

<script>
  function copyText(){
    try{
      navigator.clipboard.writeText({{ text|tojson }});
      alert("Copiato!");
    }catch(e){
      alert("Non riesco a copiare su questo browser.");
    }
  }
  // prova ad aprire WhatsApp subito (se il browser blocca, resta il bottone)
  setTimeout(function(){ window.location.href = {{ wa_url|tojson }}; }, 250);
</script>
{% endblock %}
