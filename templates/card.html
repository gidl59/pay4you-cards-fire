{% extends "base.html" %}
{% block title %}{{ ag.name }} | Pay4You{% endblock %}

{% block content %}
<div class="card-fullscreen">
  <div class="card-glass-bg"></div>

  <div class="card-outer">

    <!-- Header/logo -->
    <div class="card-header-row" style="align-items:center; justify-content:space-between; gap:12px;">
      <div>
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Pay4You" class="card-logo-big">
      </div>

      <!-- ‚úÖ Selettore lingua (solo card pubblica) -->
      <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
        <div style="font-size:12px; opacity:.8; font-weight:800;">
          {{ t("language") }}:
        </div>

        {% set keep_p = "" %}
        {% if p_key %}{% set keep_p = "&p=" ~ p_key %}{% endif %}

        <a class="link-button" href="/{{ ag.slug }}?lang=it{{ keep_p }}">IT</a>
        <a class="link-button" href="/{{ ag.slug }}?lang=en{{ keep_p }}">EN</a>
        <a class="link-button" href="/{{ ag.slug }}?lang=es{{ keep_p }}">ES</a>
        <a class="link-button" href="/{{ ag.slug }}?lang=fr{{ keep_p }}">FR</a>
        <a class="link-button" href="/{{ ag.slug }}?lang=de{{ keep_p }}">DE</a>
      </div>
    </div>

    <!-- ‚úÖ Selettore profili (se esistono) -->
    {% if profiles and (not p_key) %}
      <div class="card-section" style="margin-top:6px;">
        <h2>{{ t("multi_profile") }}</h2>
        <div style="font-size:13px; color:#cbd5f5;">
          {{ t("choose_profile") }}
        </div>

        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;">
          <a class="link-button" href="/{{ ag.slug }}?lang={{ lang }}">{{ t("open_main") }}</a>
          {% for p in profiles %}
            <a class="link-button" href="/{{ ag.slug }}?p={{ p.key }}&lang={{ lang }}">
              {{ p.label }}
            </a>
          {% endfor %}
        </div>

        <div style="margin-top:10px; font-size:12px; opacity:.8;">
          <b>QR standard:</b> /{{ ag.slug }} (mostra i profili se ci sono) <br>
          <b>NFC direct:</b> /{{ ag.slug }}?p=p1 oppure ?p=p2
        </div>
      </div>
    {% endif %}

    <!-- Business block -->
    <div class="business-card">

      <div class="card-profile-photo-wrapper">
        {% if ag.photo_url %}
          <div class="avatar-flip">
            <div class="avatar-inner">
              <div class="avatar-face avatar-front">
                <img src="{{ ag.photo_url }}" alt="Foto profilo">
              </div>
              <div class="avatar-face avatar-back">
                {% if ag.extra_logo_url %}
                  <img src="{{ ag.extra_logo_url }}" alt="Logo">
                {% else %}
                  <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo">
                {% endif %}
              </div>
            </div>
          </div>
        {% else %}
          <img class="card-profile-photo" src="{{ url_for('static', filename='logo.png') }}" alt="Pay4You">
        {% endif %}
      </div>

      <div class="card-name-block">
        <h1 class="card-name" style="margin:0;">{{ ag.name }}</h1>
        {% if ag.role %}<div class="card-role-main">{{ ag.role }}</div>{% endif %}
        {% if ag.company %}<div class="card-role-sub">{{ ag.company }}</div>{% endif %}
        {% if ag.bio %}<div class="card-bio">{{ ag.bio }}</div>{% endif %}

        {% if p_key %}
          <div style="margin-top:8px; font-size:12px; opacity:.8;">
            {{ t("direct_profile") }}: <b>{{ p_key }}</b>
          </div>
        {% endif %}
      </div>

    </div>

    <!-- CONTATTI -->
    <div class="card-section">
      <h2>{{ t("contacts") }}</h2>

      {% for m in mobiles %}
        <div class="contact-row">
          <div class="icon">üì±</div>
          <div class="label">{{ t("mobile") }}</div>
          <div class="value"><a href="tel:{{ m }}">{{ m }}</a></div>
        </div>
      {% endfor %}

      {% if ag.phone_office %}
        <div class="contact-row">
          <div class="icon">‚òéÔ∏è</div>
          <div class="label">{{ t("office") }}</div>
          <div class="value"><a href="tel:{{ ag.phone_office }}">{{ ag.phone_office }}</a></div>
        </div>
      {% endif %}

      {% for e in emails %}
        <div class="contact-row">
          <div class="icon">‚úâÔ∏è</div>
          <div class="label">{{ t("email") }}</div>
          <div class="value"><a href="mailto:{{ e }}">{{ e }}</a></div>
        </div>
      {% endfor %}

      {% if ag.pec %}
        <div class="contact-row">
          <div class="icon">üì©</div>
          <div class="label">PEC</div>
          <div class="value"><span>{{ ag.pec }}</span></div>
        </div>
      {% endif %}

      {% for w in websites %}
        <div class="contact-row">
          <div class="icon">üåê</div>
          <div class="label">{{ t("website") }}</div>
          <div class="value"><a href="{{ w }}" target="_blank" rel="noopener">{{ w }}</a></div>
        </div>
      {% endfor %}

      {% if ag.whatsapp %}
        <div class="contact-row whatsapp-row">
          <div class="icon">üí¨</div>
          <div class="label">WhatsApp</div>
          <div class="value">{{ ag.whatsapp }}</div>
        </div>
      {% endif %}
    </div>

    <!-- BUSINESS -->
    <div class="card-section">
      <h2>{{ t("business") }}</h2>

      {% if ag.piva %}
        <div class="contact-row">
          <div class="icon">üßæ</div>
          <div class="label">P.IVA</div>
          <div class="value">{{ ag.piva }}</div>
        </div>
      {% endif %}

      {% if ag.sdi %}
        <div class="contact-row">
          <div class="icon">üè∑Ô∏è</div>
          <div class="label">SDI</div>
          <div class="value">{{ ag.sdi }}</div>
        </div>
      {% endif %}

      {% if addresses %}
        <div class="address-row" style="margin-top:8px;">
          <div style="font-weight:800; color:#e5e7eb; margin-bottom:6px;">{{ t("addresses") }}</div>
          {% for a in addresses %}
            <div class="address-value">‚Ä¢ {{ a }}</div>
          {% endfor %}
        </div>
      {% endif %}
    </div>

    <!-- GALLERY -->
    {% if gallery %}
    <div class="card-section">
      <h2>{{ t("gallery") }}</h2>
      <div class="gallery-scroll">
        {% for g in gallery %}
          <a href="{{ g }}" target="_blank" rel="noopener">
            <img src="{{ g }}" alt="Foto">
          </a>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- VIDEOS -->
    {% if videos %}
    <div class="card-section">
      <h2>{{ t("videos") }}</h2>
      {% for v in videos %}
        <div style="margin-top:10px;">
          <video controls style="width:100%; border-radius:14px; border:1px solid rgba(148,163,184,0.25);">
            <source src="{{ v }}" type="video/mp4">
            {{ t("video_not_supported") }}
          </video>
        </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- PDFS -->
    {% if pdfs %}
    <div class="card-section">
      <h2>{{ t("documents") }}</h2>
      <div class="pdf-list">
        {% for p in pdfs %}
          <a class="pdf-item" href="{{ p.url }}" target="_blank" rel="noopener">
            <span class="pdf-icon">üìÑ</span>
            <span>{{ p.name }}</span>
          </a>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- ‚úÖ OPT-IN promo WhatsApp (solo PRO) -->
    {% if wa_optin_link %}
    <div class="card-section">
      <h2>{{ t("promos") }}</h2>
      <div style="font-size:13px; color:#cbd5f5; line-height:1.35;">
        {{ t("promos_desc") }}
      </div>
      <div style="margin-top:10px;">
        <a class="link-button" href="{{ wa_optin_link }}" target="_blank" rel="noopener">
          ‚úÖ {{ t("subscribe_whatsapp") }}
        </a>
      </div>
      <div style="margin-top:8px; font-size:12px; opacity:.8;">
        {{ t("stop_note") }}
      </div>
    </div>
    {% endif %}

    <div class="card-footer">
      ¬© Pay4You ‚Äî {{ t("updated_always") }}
    </div>

  </div>
</div>
{% endblock %}
