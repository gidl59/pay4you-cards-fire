<!doctype html>
<html lang="{{ lang or 'it' }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  <title>{{ ag.name }} | Pay4You Card</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body data-theme="{{ theme or 'auto' }}">
  <div class="page-main">
    <div class="card-outer card-theme">

      {% set the_logo = ag.logo_url %}

      <!-- LOGO alto sx -->
      {% if the_logo %}
        <div class="top-left-logo" style="--logoSize: {{ logo_size or 86 }}px;">
          <img class="{% if logo_spin %}spin-slow{% endif %}" src="{{ the_logo }}" alt="Logo">
        </div>
      {% endif %}

      <div class="hero">
        <div class="avatar-wrap">

          <!-- FLIP (foto <-> logo) su click (opzionale) -->
          {% if flip_avatar and the_logo %}
            <div class="flip-card" onclick="this.classList.toggle('flipped')">
              <div class="flip-inner">
                <div class="flip-front">
                  <div class="avatar">
                    {% if ag.photo_url %}
                      <img class="avatar-img" src="{{ ag.photo_url }}" alt="Foto profilo">
                    {% else %}
                      <div class="avatar-placeholder">üë§</div>
                    {% endif %}
                  </div>
                </div>
                <div class="flip-back">
                  <div class="avatar">
                    <img class="avatar-img" src="{{ the_logo }}" alt="Logo">
                  </div>
                </div>
              </div>
            </div>
          {% else %}
            <div class="avatar {% if avatar_spin %}spin{% endif %}">
              {% if ag.photo_url %}
                <img class="avatar-img" src="{{ ag.photo_url }}" alt="Foto profilo">
              {% else %}
                <div class="avatar-placeholder">üë§</div>
              {% endif %}
            </div>
          {% endif %}
        </div>

        <div class="hero-text">
          {% if ag.name %}<div class="name">{{ ag.name }}</div>{% endif %}
          {% if ag.company %}<div class="company">{{ ag.company }}</div>{% endif %}
          {% if ag.role %}<div class="role role-pill">{{ ag.role }}</div>{% endif %}
          {% if ag.bio %}<div class="bio">{{ ag.bio }}</div>{% endif %}

          {% if p2_enabled %}
            <div class="profile-switch">
              <a class="profile-pill {% if not p_key %}active{% endif %}"
                 href="/{{ ag.slug }}{% if request.args.get('lang') %}?lang={{ request.args.get('lang') }}{% endif %}">
                Profilo 1
              </a>
              <a class="profile-pill {% if p_key=='p2' %}active{% endif %}"
                 href="/{{ ag.slug }}?p=p2{% if request.args.get('lang') %}&lang={{ request.args.get('lang') }}{% endif %}">
                Profilo 2
              </a>
            </div>
          {% endif %}

          <!-- SOCIAL ICONS -->
          <div class="soc-row">
            {% if wa_link %}
              <a class="soc-btn" href="{{ wa_link }}" target="_blank" rel="noopener" aria-label="WhatsApp">
                <span class="soc-ico">
                  <!-- WA -->
                  <svg viewBox="0 0 32 32" width="18" height="18" aria-hidden="true">
                    <path d="M19.11 17.53c-.28-.14-1.64-.8-1.9-.89-.26-.1-.45-.14-.64.14-.19.28-.74.89-.91 1.07-.17.19-.34.21-.62.07-.28-.14-1.2-.44-2.28-1.4-.84-.74-1.4-1.66-1.56-1.94-.17-.28-.02-.43.12-.57.12-.12.28-.34.43-.5.14-.17.19-.28.28-.48.1-.19.05-.36-.02-.5-.07-.14-.64-1.55-.88-2.12-.23-.56-.46-.48-.64-.49h-.55c-.19 0-.5.07-.76.36-.26.28-1 1-1 2.44s1.02 2.84 1.16 3.03c.14.19 2.01 3.07 4.88 4.3.68.29 1.2.47 1.61.6.68.22 1.29.19 1.78.12.54-.08 1.64-.67 1.87-1.32.23-.65.23-1.21.16-1.32-.07-.11-.26-.18-.54-.32z"/>
                    <path d="M16.02 3C9.39 3 4 8.39 4 15.02c0 2.33.67 4.5 1.82 6.33L4 29l7.84-1.73a12 12 0 0 0 4.18.75C22.65 28.02 28 22.65 28 16.02 28 9.39 22.65 4 16.02 3zm0 22.01c-1.35 0-2.6-.28-3.75-.78l-.27-.12-4.65 1.03 1-4.53-.15-.29a9.93 9.93 0 0 1-1.5-5.27c0-5.53 4.5-10.03 10.03-10.03 5.53 0 10.03 4.5 10.03 10.03 0 5.53-4.5 9.96-10.03 9.96z"/>
                  </svg>
                </span>
              </a>
            {% endif %}

            {% if ag.instagram %}
              <a class="soc-btn" href="{{ ag.instagram }}" target="_blank" rel="noopener" aria-label="Instagram">
                <span class="soc-ico">
                  <!-- IG -->
                  <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                    <path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm10 2H7a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3zm-5 3.5A5.5 5.5 0 1 1 6.5 13 5.5 5.5 0 0 1 12 7.5zm0 2A3.5 3.5 0 1 0 15.5 13 3.5 3.5 0 0 0 12 9.5zm6.2-2.35a1.3 1.3 0 1 1-1.3-1.3 1.3 1.3 0 0 1 1.3 1.3z"/>
                  </svg>
                </span>
              </a>
            {% endif %}

            {% if ag.facebook %}
              <a class="soc-btn" href="{{ ag.facebook }}" target="_blank" rel="noopener" aria-label="Facebook">
                <span class="soc-ico">
                  <!-- FB -->
                  <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                    <path d="M14 9h2V6h-2c-2.2 0-4 1.8-4 4v2H8v3h2v7h3v-7h2.2l.8-3H13v-2c0-.6.4-1 1-1z"/>
                  </svg>
                </span>
              </a>
            {% endif %}
          </div>

        </div>
      </div>

      <div class="section actions-box big-actions">
        <div class="section-title">Azioni</div>
        <div class="actions-row">
          <a class="action-btn big" href="/{{ ag.slug }}.vcf">{{ t_func('save_contact') }}</a>
          <button class="action-btn secondary big" type="button" onclick="openMediaModal('{{ qr_url }}', 'image')">
            QR Code
          </button>
        </div>
        <div class="actions-hint">Suggerimento: salva il contatto e condividi la card ai tuoi clienti.</div>
      </div>

      <div class="section">
        <div class="section-title">{{ t_func('contacts') }}</div>

        {% if mobiles and mobiles|length > 0 %}
          {% for m in mobiles %}
            <div class="row"><span>Cellulare</span><a href="tel:{{ m }}">{{ m }}</a></div>
          {% endfor %}
        {% endif %}

        {% if ag.phone_office %}
          <div class="row"><span>Ufficio</span><a href="tel:{{ ag.phone_office }}">{{ ag.phone_office }}</a></div>
        {% endif %}

        {% if wa_link %}
          <div class="row"><span>WhatsApp</span><a href="{{ wa_link }}" target="_blank" rel="noopener">Apri WhatsApp</a></div>
        {% endif %}

        {% if emails and emails|length > 0 %}
          {% for e in emails %}
            <div class="row"><span>Email</span><a href="mailto:{{ e }}">{{ e }}</a></div>
          {% endfor %}
        {% endif %}

        {% if ag.pec %}
          <div class="row"><span>PEC</span><a href="mailto:{{ ag.pec }}">{{ ag.pec }}</a></div>
        {% endif %}

        {% if websites and websites|length > 0 %}
          {% for w in websites %}
            <div class="row"><span>Sito</span><a href="{{ w }}" target="_blank" rel="noopener">Apri sito</a></div>
          {% endfor %}
        {% endif %}
      </div>

      {% if ag.piva or ag.sdi or (addresses and addresses|length > 0) %}
        <div class="section">
          <div class="section-title">Dati</div>
          {% if ag.piva %}<div class="row"><span>P.IVA</span><span>{{ ag.piva }}</span></div>{% endif %}
          {% if ag.sdi %}<div class="row"><span>SDI</span><span>{{ ag.sdi }}</span></div>{% endif %}

          {% if addresses and addresses|length > 0 %}
            <div class="addr-list">
              {% for a in addresses %}
                <a class="addr-item" href="{{ a.maps }}" target="_blank" rel="noopener">
                  üìç {{ a.text }} <span class="addr-mini">(Apri Maps)</span>
                </a>
              {% endfor %}
            </div>
          {% endif %}
        </div>
      {% endif %}

      {% if gallery and gallery|length > 0 %}
        <div class="section">
          <div class="section-title">Foto</div>
          <div class="gallery-scroll">
            {% for img in gallery %}
              <button class="thumb" type="button" onclick="openMediaModal('{{ img }}', 'image')">
                <img src="{{ img }}" alt="Foto {{ loop.index }}">
              </button>
            {% endfor %}
          </div>
        </div>
      {% endif %}

      {% if videos and videos|length > 0 %}
        <div class="section">
          <div class="section-title">Video</div>
          <div class="gallery-scroll">
            {% for v in videos %}
              <button class="thumb" type="button" onclick="openMediaModal('{{ v }}', 'video')">
                <div class="video-thumb">
                  <span class="video-play">‚ñ∂</span>
                  <video class="video-mini" muted playsinline preload="metadata">
                    <source src="{{ v }}">
                  </video>
                </div>
              </button>
            {% endfor %}
          </div>
        </div>
      {% endif %}

      {% if pdfs and pdfs|length > 0 %}
        <div class="section">
          <div class="section-title">Documenti</div>
          <div class="pdf-list">
            {% for p in pdfs %}
              <button class="pdf-btn" type="button" onclick="openMediaModal('{{ p.url }}', 'pdf')">
                üìÑ {{ p.name }}
              </button>
            {% endfor %}
          </div>
        </div>
      {% endif %}

      <div class="footer">
        Realizzato ¬© Pay4You da Giuseppe Di Lisio 2026
      </div>

    </div>
  </div>

  <!-- MODAL unico (IMG / VIDEO / PDF) -->
  <div id="mediaModal" class="modal-overlay" style="display:none;">
    <div class="modal-box modal-box-big">
      <button class="modal-x" type="button" onclick="closeMediaModal()">‚úï</button>

      <img id="mImg" src="" alt="media" class="modal-media-img" style="display:none;">
      <video id="mVideo" controls playsinline class="modal-media-video" style="display:none;">
        <source id="mVideoSrc" src="">
      </video>
      <iframe id="mPdf" src="" class="modal-media-pdf" style="display:none;" title="pdf"></iframe>

      <button class="modal-close" type="button" onclick="closeMediaModal()">Chiudi</button>
    </div>
  </div>

  <script>
    function openMediaModal(src, type){
      const modal = document.getElementById('mediaModal');
      const img = document.getElementById('mImg');
      const vid = document.getElementById('mVideo');
      const vidSrc = document.getElementById('mVideoSrc');
      const pdf = document.getElementById('mPdf');

      img.style.display='none';
      vid.style.display='none';
      pdf.style.display='none';

      img.src='';
      pdf.src='';
      try{ vid.pause(); }catch(e){}
      vidSrc.src='';

      if(type === 'video'){
        vidSrc.src = src;
        vid.load();
        vid.style.display='block';
      } else if(type === 'pdf'){
        pdf.src = src;
        pdf.style.display='block';
      } else {
        img.src = src;
        img.style.display='block';
      }

      modal.style.display='flex';
    }

    function closeMediaModal(){
      const modal = document.getElementById('mediaModal');
      const vid = document.getElementById('mVideo');
      const vidSrc = document.getElementById('mVideoSrc');
      const pdf = document.getElementById('mPdf');

      try{ vid.pause(); }catch(e){}
      vidSrc.src='';
      pdf.src='';
      modal.style.display='none';
    }
  </script>
</body>
</html>
