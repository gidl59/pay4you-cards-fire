<!doctype html>
<html lang="{{ lang|default('it') }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="format-detection" content="telephone=no">
  <meta name="color-scheme" content="light dark">
  <title>{{ ag.name }} | Pay4You</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">

  <!-- âœ… Applica tema prima del render (evita flash) -->
  <script>
    (function(){
      try{
        var t = localStorage.getItem("p4y_theme") || "auto";
        document.documentElement.setAttribute("data-theme", (t==="auto") ? "" : t);
      }catch(e){}
    })();
  </script>
</head>

<body data-theme="">
  <div class="page-main">
    <div class="card-outer">

      <!-- Torna indietro -->
      <div style="position:absolute; top:12px; right:12px; z-index:6;">
        <button class="btn-mini" type="button" onclick="history.back()" title="Torna indietro">â†© Torna indietro</button>
      </div>

      <!-- Top left logo (ruota quando orbit_spin=1) -->
      {% if ag.logo_url %}
      <div class="top-left-logo {% if (ag.orbit_spin or 0)|int == 1 %}spin{% endif %}">
        <img src="{{ ag.logo_url }}" alt="Logo" loading="lazy">
      </div>
      {% endif %}

      <!-- HERO -->
      <div class="hero hero-center">
        <div class="avatar-wrap">

          {% if ag.logo_url %}
          <div class="orbit {% if (ag.orbit_spin or 0)|int == 1 %}spin{% endif %}">
            <img src="{{ ag.logo_url }}" alt="Logo orbit" loading="lazy">
          </div>
          {% endif %}

          {% set can_flip = (ag.allow_flip or 0)|int == 1 %}
          <div class="flip {% if can_flip %}is-flippable{% endif %}" id="flipBox">
            <div class="flip-inner">
              <div class="flip-front">
                <div class="avatar {% if (ag.avatar_spin or 0)|int == 1 %}spin-self{% endif %}">
                  {% if ag.photo_url %}
                    <img class="avatar-img" src="{{ ag.photo_url }}" alt="Foto" loading="lazy">
                  {% else %}
                    <div class="avatar-placeholder">ðŸ‘¤</div>
                  {% endif %}
                </div>
              </div>
              <div class="flip-back">
                <div class="avatar">
                  {% if ag.logo_url %}
                    <img class="avatar-img"
                         style="object-fit:contain; padding:18px; {% if (ag.logo_spin or 0)|int == 1 %}animation: spin360 10s linear infinite;{% endif %}"
                         src="{{ ag.logo_url }}" alt="Logo" loading="lazy">
                  {% else %}
                    <div class="avatar-placeholder">â˜…</div>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>

        </div>

        <div class="hero-text hero-text-center">
          {% if ag.name %}<div class="name name-center">{{ ag.name }}</div>{% endif %}
          {% if ag.company %}<div class="company company-center">{{ ag.company }}</div>{% endif %}
          {% if ag.role %}<div class="role role-center">{{ ag.role }}</div>{% endif %}
          {% if ag.bio %}<div class="bio bio-center">{{ ag.bio }}</div>{% endif %}

          <!-- Switch profilo -->
          {% if p2_enabled %}
          <div class="profile-switch profile-switch-center">
            <a class="profile-pill {% if not p_key %}active{% endif %}" href="/{{ ag.slug }}?lang={{ lang }}">{{ t_func('profile_1') }}</a>
            <a class="profile-pill {% if p_key == 'p2' %}active{% endif %}" href="/{{ ag.slug }}?p=p2&lang={{ lang }}">{{ t_func('profile_2') }}</a>
          </div>
          {% endif %}

          <!-- SOCIAL ICONS A COLORI -->
          <div class="social-icons social-icons-center">
            {% if ag.facebook %}
              <a class="soc" href="{{ ag.facebook }}" target="_blank" rel="noopener" aria-label="Facebook">
                <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
                  <path fill="#1877F2" d="M22 12a10 10 0 1 0-11.56 9.87v-6.99H7.9V12h2.54V9.8c0-2.5 1.49-3.89 3.77-3.89 1.09 0 2.23.2 2.23.2v2.46h-1.25c-1.23 0-1.61.77-1.61 1.55V12h2.74l-.44 2.88h-2.3v6.99A10 10 0 0 0 22 12z"/>
                </svg>
              </a>
            {% endif %}

            {% if ag.instagram %}
              {% set ig_id = "ig-" ~ ag.slug ~ "-" ~ (p_key if p_key else "p1") %}
              <a class="soc" href="{{ ag.instagram }}" target="_blank" rel="noopener" aria-label="Instagram">
                <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
                  <defs>
                    <linearGradient id="{{ ig_id }}" x1="0" y1="24" x2="24" y2="0">
                      <stop offset="0" stop-color="#F58529"/>
                      <stop offset="0.5" stop-color="#DD2A7B"/>
                      <stop offset="1" stop-color="#515BD4"/>
                    </linearGradient>
                  </defs>
                  <path fill="url(#{{ ig_id }})" d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm10 2H7a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3zm-5 3.2A4.8 4.8 0 1 1 7.2 12 4.8 4.8 0 0 1 12 7.2zm0 2A2.8 2.8 0 1 0 14.8 12 2.8 2.8 0 0 0 12 9.2zM17.7 6.1a1.1 1.1 0 1 1-1.1 1.1 1.1 1.1 0 0 1 1.1-1.1z"/>
                </svg>
              </a>
            {% endif %}

            {% if ag.linkedin %}
              <a class="soc" href="{{ ag.linkedin }}" target="_blank" rel="noopener" aria-label="LinkedIn">
                <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
                  <path fill="#0A66C2" d="M20.45 20.45h-3.55v-5.57c0-1.33-.03-3.04-1.86-3.04-1.86 0-2.14 1.45-2.14 2.95v5.66H9.31V9h3.41v1.56h.05c.47-.9 1.62-1.86 3.34-1.86 3.57 0 4.23 2.35 4.23 5.4v6.35zM5.34 7.43a2.06 2.06 0 1 1 0-4.12 2.06 2.06 0 0 1 0 4.12zM7.12 20.45H3.56V9h3.56v11.45z"/>
                </svg>
              </a>
            {% endif %}

            {% if ag.tiktok %}
              <a class="soc" href="{{ ag.tiktok }}" target="_blank" rel="noopener" aria-label="TikTok">
                <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
                  <path fill="#25F4EE" d="M14.5 3v11.1a3.6 3.6 0 1 1-3.1-3.6V7.6a7.3 7.3 0 1 0 6.6 7.3V9.2a6.1 6.1 0 0 1-3.5-1.7V3z"/>
                  <path fill="#FE2C55" d="M14.5 3v3.5a6.1 6.1 0 0 0 3.5 1.7V6.1A6.8 6.8 0 0 1 14.5 3z"/>
                  <path fill="#111111" d="M11.4 7.6v2.9a3.6 3.6 0 1 0 3.1 3.6V3h-2.1v4.6z"/>
                </svg>
              </a>
            {% endif %}

            {% if ag.telegram %}
              <a class="soc" href="{{ ag.telegram }}" target="_blank" rel="noopener" aria-label="Telegram">
                <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
                  <path fill="#2AABEE" d="M21.9 4.6 19 20.2c-.2 1.1-.8 1.4-1.6.9l-4.5-3.3-2.2 2.1c-.2.2-.4.4-.8.4l.3-4.7 8.6-7.8c.4-.3-.1-.5-.6-.2l-10.6 6.7-4.6-1.4c-1-.3-1-1 .2-1.5L20 3.8c.9-.3 1.7.2 1.4.8z"/>
                </svg>
              </a>
            {% endif %}

            {% if ag.youtube %}
              <a class="soc" href="{{ ag.youtube }}" target="_blank" rel="noopener" aria-label="YouTube">
                <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
                  <path fill="#FF0000" d="M21.6 7.2a3 3 0 0 0-2.1-2.1C17.7 4.6 12 4.6 12 4.6s-5.7 0-7.5.5A3 3 0 0 0 2.4 7.2 31 31 0 0 0 2 12a31 31 0 0 0 .4 4.8 3 3 0 0 0 2.1 2.1c1.8.5 7.5.5 7.5.5s5.7 0 7.5-.5a3 3 0 0 0 2.1-2.1A31 31 0 0 0 22 12a31 31 0 0 0-.4-4.8z"/>
                  <path fill="#fff" d="M10 15.5V8.5L16 12l-6 3.5z"/>
                </svg>
              </a>
            {% endif %}
          </div>

        </div>
      </div>

      <!-- AZIONI -->
      <div class="section actions-box">
        <div class="section-title">{{ t_func('actions') }}</div>
        <div class="actions-row">
          <a class="action-btn" href="/{{ ag.slug }}.vcf">{{ t_func('save_contact') }}</a>
          {% if wa_link %}
            <a class="action-btn secondary" href="{{ wa_link }}" target="_blank" rel="noopener">{{ t_func('whatsapp') }}</a>
          {% endif %}
          <button class="action-btn" type="button" onclick="openQrModal({{ qr_url|tojson }})">{{ t_func('scan_qr') }}</button>
        </div>
        <div class="actions-hint">{{ t_func('save_contact') }}: aggiunge i dati in rubrica.</div>
      </div>

      <!-- CONTATTI -->
      {% if mobiles or ag.phone_office or emails or pec_email or websites %}
      <div class="section">
        <div class="section-title">{{ t_func('contacts') }}</div>

        {% if mobiles %}
          <div class="row">
            <span>{{ t_func('mobile_phone') }}</span>
            <div style="text-align:right;">
              {% for m in mobiles %}
                <div><a href="tel:{{ m|replace(' ','') }}">{{ m }}</a></div>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        {% if ag.phone_office %}
          <div class="row">
            <span>{{ t_func('office_phone') }}</span>
            <a href="tel:{{ ag.phone_office|replace(' ','') }}">{{ ag.phone_office }}</a>
          </div>
        {% endif %}

        {% if emails %}
          <div class="row">
            <span>Email</span>
            <div style="text-align:right;">
              {% for e in emails %}
                <div><a href="mailto:{{ e }}">{{ e }}</a></div>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        {% if pec_email %}
          <div class="row">
            <span>PEC</span>
            <a href="mailto:{{ pec_email }}">{{ pec_email }}</a>
          </div>
        {% endif %}

        {% if websites %}
          <div class="row">
            <span>{{ t_func('open_website') }}</span>
            <div style="text-align:right;">
              {% for w in websites %}
                <div><a href="{{ w }}" target="_blank" rel="noopener">{{ w|replace('https://','')|replace('http://','') }}</a></div>
              {% endfor %}
            </div>
          </div>
        {% endif %}
      </div>
      {% endif %}

      <!-- DATI -->
      {% if ag.piva or ag.sdi %}
      <div class="section">
        <div class="section-title">{{ t_func('data') }}</div>
        {% if ag.piva %}
          <div class="row"><span>{{ t_func('vat') }}</span><span class="mono">{{ ag.piva }}</span></div>
        {% endif %}
        {% if ag.sdi %}
          <div class="row"><span>{{ t_func('sdi') }}</span><span class="mono">{{ ag.sdi }}</span></div>
        {% endif %}
      </div>
      {% endif %}

      <!-- INDIRIZZI -->
      {% if addresses %}
      <div class="section">
        <div class="section-title">{{ t_func('open_maps') }}</div>
        <div class="addr-list">
          {% for a in addresses %}
            <a class="addr-item" href="{{ a.maps }}" target="_blank" rel="noopener">
              <div>{{ a.text }}</div>
              <div class="addr-mini">{{ t_func('open_maps') }}</div>
            </a>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- THEME TOGGLE -->
      <div class="section">
        <div class="section-title">{{ t_func('theme') }}</div>
        <div class="theme-toggle theme-toggle-compact">
          <span class="theme-label">{{ t_func('theme') }}:</span>
          <button class="theme-pill" type="button" data-theme="auto">{{ t_func('theme_auto') }}</button>
          <button class="theme-pill" type="button" data-theme="light">{{ t_func('theme_light') }}</button>
          <button class="theme-pill" type="button" data-theme="dark">{{ t_func('theme_dark') }}</button>
        </div>
      </div>

      <!-- FOTO -->
      {% if gallery %}
      <div class="section">
        <div class="section-title">{{ t_func('gallery') }}</div>
        <div class="gallery-scroll">
          {% for g in gallery %}
            <button class="thumb" type="button" onclick="openImg({{ g|tojson }})">
              <img src="{{ g }}" alt="Foto" loading="lazy">
            </button>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- VIDEO -->
      {% if videos %}
      <div class="section">
        <div class="section-title">{{ t_func('videos') }}</div>
        <div class="gallery-scroll">
          {% for v in videos %}
            <div class="video-thumb">
              <video class="video-mini" src="{{ v }}" muted playsinline preload="metadata"></video>
              <div class="video-play">PLAY</div>
              <button class="thumb" type="button" style="position:absolute; inset:0;" onclick="openVideo({{ v|tojson }})"></button>
            </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- PDF -->
      {% if pdfs %}
      <div class="section">
        <div class="section-title">{{ t_func('documents') }}</div>
        <div class="pdf-list">
          {% for p in pdfs %}
            <button class="pdf-btn" type="button" onclick="openPdf({{ p.url|tojson }})">{{ p.name }}</button>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <div class="footer">Â© 2026 Realizzato Pay4You â€” Giuseppe Di Lisio</div>

    </div>
  </div>

  <!-- MODAL -->
  <div id="modal" class="modal-overlay" style="display:none;">
    <div class="modal-box">
      <button class="modal-x" type="button" onclick="closeModal()">âœ•</button>
      <img id="mImg" src="" alt="" style="display:none;">
      <video id="mVideo" controls playsinline style="display:none;"></video>
      <iframe id="mPdf" src="" style="display:none;"></iframe>
      <button class="modal-close" type="button" onclick="closeModal()">{{ t_func('close') }}</button>
    </div>
  </div>

  <!-- QR MODAL -->
  <div id="qr-modal" class="modal-overlay" style="display:none;">
    <div class="modal-box">
      <button class="modal-x" type="button" onclick="closeQrModal()">âœ•</button>
      <img id="qr-img" src="" alt="QR" style="width:100%;max-width:520px;display:block;margin:8px auto;border-radius:14px;">
      <button class="modal-close" type="button" onclick="closeQrModal()">{{ t_func('close') }}</button>
    </div>
  </div>

<script>
  // flip
  (function(){
    const canFlip = {{ 1 if (ag.allow_flip or 0)|int == 1 else 0 }};
    if(!canFlip) return;
    const box = document.getElementById('flipBox');
    if(!box) return;
    box.addEventListener('click', ()=> box.classList.toggle('flipped'));
  })();

  // theme
  (function(){
    const KEY = "p4y_theme";
    const buttons = document.querySelectorAll(".theme-pill");

    function apply(theme){
      // âœ… allineo html + body
      document.documentElement.setAttribute("data-theme", theme === "auto" ? "" : theme);
      document.body.setAttribute("data-theme", theme === "auto" ? "" : theme);
      buttons.forEach(b => b.classList.toggle("active", b.dataset.theme === theme));
    }

    let saved = "auto";
    try{ saved = localStorage.getItem(KEY) || "auto"; }catch(e){}
    apply(saved);

    buttons.forEach(b => {
      b.addEventListener("click", () => {
        try{ localStorage.setItem(KEY, b.dataset.theme); }catch(e){}
        apply(b.dataset.theme);
      });
    });
  })();

  // modal helpers
  function openModal(type){
    const modal = document.getElementById('modal');
    if(!modal) return;

    document.body.style.overflow = 'hidden';
    modal.style.display='flex';

    const img = document.getElementById('mImg');
    const vid = document.getElementById('mVideo');
    const pdf = document.getElementById('mPdf');

    if(img) img.style.display = (type==='img') ? 'block' : 'none';
    if(vid) vid.style.display = (type==='video') ? 'block' : 'none';
    if(pdf) pdf.style.display = (type==='pdf') ? 'block' : 'none';
  }

  function closeModal(){
    const modal = document.getElementById('modal');
    if(modal) modal.style.display='none';
    document.body.style.overflow = '';

    const img = document.getElementById('mImg');
    const vid = document.getElementById('mVideo');
    const pdf = document.getElementById('mPdf');

    if(img) img.src = '';

    if(vid){
      try{ vid.pause(); }catch(e){}
      vid.removeAttribute('src');
      try{ vid.load(); }catch(e){}
    }

    if(pdf) pdf.src = '';
  }

  function openImg(src){
    const img = document.getElementById('mImg');
    if(!img) return;
    img.src = src;
    openModal('img');
  }

  function openVideo(src){
    const v = document.getElementById('mVideo');
    if(!v) return;
    v.src = src;
    openModal('video');
    v.play().catch(()=>{});
  }

  function openPdf(src){
    const f = document.getElementById('mPdf');
    if(!f) return;
    f.src = src;
    openModal('pdf');
  }

  // QR modal
  function openQrModal(src){
    const m = document.getElementById('qr-modal');
    const img = document.getElementById('qr-img');
    if(!m || !img) return;
    img.src = src;
    document.body.style.overflow = 'hidden';
    m.style.display = 'flex';
  }

  function closeQrModal(){
    const m = document.getElementById('qr-modal');
    const img = document.getElementById('qr-img');
    if(img) img.src = '';
    if(m) m.style.display = 'none';
    document.body.style.overflow = '';
  }
</script>
</body>
</html>
