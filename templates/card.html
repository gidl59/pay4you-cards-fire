{% extends "base.html" %}
{% block title %}{{ ag.name }} | Pay4You{% endblock %}

{% block content %}
<div class="card-fullscreen">
  <div class="card-glass-bg"></div>

  <div class="card-outer">

    <!-- HEADER: logo + lingua -->
    <div class="card-header-row" style="align-items:center; justify-content:space-between; gap:12px;">
      <div>
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Pay4You" class="card-logo-big">
      </div>

      <div style="display:flex; align-items:center; gap:8px; flex-wrap:wrap;">
        <div style="font-size:12px; opacity:.8; font-weight:800;">
          {{ t("language") }}:
        </div>

        {% set keep_p = "" %}
        {% if p_key %}{% set keep_p = "&p=" ~ p_key %}{% endif %}

        <a class="link-button" href="/{{ ag.slug }}?lang=it{{ keep_p }}" style="{% if lang=='it' %}font-weight:800;text-decoration:underline;{% endif %}">
          IT
        </a>
        <a class="link-button" href="/{{ ag.slug }}?lang=en{{ keep_p }}" style="{% if lang=='en' %}font-weight:800;text-decoration:underline;{% endif %}">
          EN
        </a>
      </div>
    </div>

    <!-- ‚úÖ PROFILI: sempre visibili se esistono profili nel JSON -->
    {% if profiles %}
      <div class="card-section" style="margin-top:6px;">
        <h2>{{ t("multi_profile") }}</h2>

        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;">
          <!-- MAIN -->
          <a class="link-button"
             href="/{{ ag.slug }}?lang={{ lang }}"
             style="{% if not p_key %}background:rgba(250,204,21,0.15); border-color:rgba(250,204,21,0.65); font-weight:800;{% endif %}">
            {{ t("open_main") }}
          </a>

          <!-- PROFILI -->
          {% for p in profiles %}
            <a class="link-button"
               href="/{{ ag.slug }}?p={{ p.key }}&lang={{ lang }}"
               style="{% if p_key == p.key %}background:rgba(250,204,21,0.15); border-color:rgba(250,204,21,0.65); font-weight:800;{% endif %}">
              {{ p.label_ui }}
            </a>
          {% endfor %}
        </div>

        {% if p_key %}
          <div style="margin-top:8px; font-size:12px; opacity:.8;">
            {{ t("direct_profile") }}: <b>{{ p_key }}</b>
          </div>
        {% endif %}
      </div>
    {% endif %}

    <!-- BUSINESS CARD -->
    <div class="business-card">
      <div class="card-profile-photo-wrapper">
        {% if ag.photo_url %}
          <div class="avatar-flip">
            <div class="avatar-inner">
              <div class="avatar-face avatar-front">
                <img src="{{ ag.photo_url }}" alt="Foto profilo">
              </div>
              <div class="avatar-face avatar-back">
                {% if ag.extra_logo_url %}
                  <img src="{{ ag.extra_logo_url }}" alt="Logo">
                {% else %}
                  <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo">
                {% endif %}
              </div>
            </div>
          </div>
        {% else %}
          <img class="card-profile-photo" src="{{ url_for('static', filename='logo.png') }}" alt="Pay4You">
        {% endif %}
      </div>

      <div class="card-name-block">
        <h1 class="card-name" style="margin:0;">{{ ag.name }}</h1>
        {% if ag.role %}<div class="card-role-main">{{ ag.role }}</div>{% endif %}
        {% if ag.company %}<div class="card-role-sub">{{ ag.company }}</div>{% endif %}
        {% if ag.bio %}<div class="card-bio">{{ ag.bio }}</div>{% endif %}
      </div>
    </div>

    <!-- CONTATTI -->
    <div class="card-section">
      <h2>{{ t("contacts") }}</h2>

      {% for m in mobiles %}
        <div class="contact-row">
          <div class="icon">üì±</div>
          <div class="label">{{ t("mobile") }}</div>
          <div class="value"><a href="tel:{{ m }}">{{ m }}</a></div>
        </div>
      {% endfor %}

      {% if ag.phone_office %}
        <div class="contact-row">
          <div class="icon">‚òéÔ∏è</div>
          <div class="label">{{ t("office") }}</div>
          <div class="value"><a href="tel:{{ ag.phone_office }}">{{ ag.phone_office }}</a></div>
        </div>
      {% endif %}

      {% for e in emails %}
        <div class="contact-row">
          <div class="icon">‚úâÔ∏è</div>
          <div class="label">{{ t("email") }}</div>
          <div class="value"><a href="mailto:{{ e }}">{{ e }}</a></div>
        </div>
      {% endfor %}

      {% for w in websites %}
        <div class="contact-row">
          <div class="icon">üåê</div>
          <div class="label">{{ t("website") }}</div>
          <div class="value"><a href="{{ w }}" target="_blank" rel="noopener">{{ w }}</a></div>
        </div>
      {% endfor %}
    </div>

    {% if addresses %}
    <div class="card-section">
      <h2>{{ t("addresses") }}</h2>
      {% for a in addresses %}
        <div class="address-value">‚Ä¢ {{ a }}</div>
      {% endfor %}
    </div>
    {% endif %}

    {% if gallery %}
    <div class="card-section">
      <h2>{{ t("gallery") }}</h2>
      <div class="gallery-scroll">
        {% for g in gallery %}
          <a href="{{ g }}" target="_blank" rel="noopener"><img src="{{ g }}" alt="Foto"></a>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    {% if videos %}
    <div class="card-section">
      <h2>{{ t("videos") }}</h2>
      {% for v in videos %}
        <div style="margin-top:10px;">
          <video controls style="width:100%; border-radius:14px; border:1px solid rgba(148,163,184,0.25);">
            <source src="{{ v }}" type="video/mp4">
            {{ t("video_not_supported") }}
          </video>
        </div>
      {% endfor %}
    </div>
    {% endif %}

    {% if pdfs %}
    <div class="card-section">
      <h2>{{ t("documents") }}</h2>
      <div class="pdf-list">
        {% for p in pdfs %}
          <a class="pdf-item" href="{{ p.url }}" target="_blank" rel="noopener">
            <span class="pdf-icon">üìÑ</span><span>{{ p.name }}</span>
          </a>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- Promo WA (PRO) -->
    {% if wa_optin_link %}
    <div class="card-section">
      <h2>{{ t("promos") }}</h2>
      <div style="font-size:13px; color:#cbd5f5; line-height:1.35;">
        {{ t("promos_desc") }}
      </div>
      <div style="margin-top:10px;">
        <a class="link-button" href="{{ wa_optin_link }}" target="_blank" rel="noopener">
          ‚úÖ {{ t("subscribe_whatsapp") }}
        </a>
      </div>
      <div style="margin-top:8px; font-size:12px; opacity:.8;">
        {{ t("stop_note") }}
      </div>
    </div>
    {% endif %}

    <div class="card-footer">¬© Pay4You ‚Äî {{ t("updated_always") }}</div>
  </div>
</div>
{% endblock %}
