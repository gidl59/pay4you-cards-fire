<!doctype html>
<html lang="{{ lang }}">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ ag.name }} | Pay4You</title>
  <link rel="stylesheet" href="/static/card.css">
</head>
<body data-theme="auto">
  <div class="card-wrap">
    <div class="hero"></div>
    
    <div class="avatar-wrap">
      <div class="avatar">
        {% if ag.photo_url %}
          <img src="{{ ag.photo_url }}" style="object-position: {{ ag.photo_pos_x }}% {{ ag.photo_pos_y }}%; transform: scale({{ ag.photo_zoom }});">
        {% else %}
          <div style="font-size:50px; text-align:center; padding-top:30px;">ðŸ‘¤</div>
        {% endif %}
      </div>
    </div>

    <div class="title">
      <h1>{{ ag.name }}</h1>
      {% if ag.role %}<div class="sub">{{ ag.role }}</div>{% endif %}
      {% if ag.company %}<div class="sub">{{ ag.company }}</div>{% endif %}
    </div>

    {% if ag.bio %}<div class="bio">{{ ag.bio }}</div>{% endif %}

    {% if socials %}
      <div class="social-row">
        {% for s in socials %}
          <a class="social" href="{{ s.url }}" target="_blank">
            <span>{{ s.label[:1] }}</span>
          </a>
        {% endfor %}
      </div>
    {% endif %}

    <div class="actions">
      <a class="btn primary" href="/vcf/{{ ag.slug }}">{{ t_func('save_contact') }}</a>
      <button class="btn-qr" onclick="openShareModal('qr', '{{ qr_url }}', 'QR')">QR</button>
    </div>

    <div class="content">
      {% for m in mobiles %}<div class="row"><div class="v"><a href="tel:{{ m }}">{{ m }}</a></div></div>{% endfor %}
      {% for e in emails %}<div class="row"><div class="v"><a href="mailto:{{ e }}">{{ e }}</a></div></div>{% endfor %}
      {% for w in websites %}<div class="row"><div class="v"><a href="{{ w }}" target="_blank">{{ w }}</a></div></div>{% endfor %}
    </div>

    <div class="switch-row">
      <div style="margin-bottom:10px">
        <a class="ps-btn {% if profile=='p1' %}active{% endif %}" href="/{{ ag.slug }}">P1</a>
        {% if p2_enabled == 1 %}<a class="ps-btn {% if profile=='p2' %}active{% endif %}" href="/{{ ag.slug }}?p=p2">P2</a>{% endif %}
        {% if p3_enabled == 1 %}<a class="ps-btn {% if profile=='p3' %}active{% endif %}" href="/{{ ag.slug }}?p=p3">P3</a>{% endif %}
      </div>
      <div>
        <button class="ts" data-theme="light">Chiaro</button>
        <button class="ts" data-theme="dark">Scuro</button>
        <button class="ts" data-theme="auto">Auto</button>
      </div>
    </div>

    <footer class="foot">
      Pay4You Card 2026
    </footer>
  </div>

  <script>
    const root = document.body;
    function applyTheme(th) {
      if (th === 'auto') {
        const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        root.setAttribute('data-theme', isDark ? 'dark' : 'light');
      } else {
        root.setAttribute('data-theme', th);
      }
      document.querySelectorAll('.ts').forEach(b => b.classList.toggle('active', b.dataset.theme === th));
      localStorage.setItem('p4y_theme', th);
    }
    
    const saved = localStorage.getItem('p4y_theme') || 'auto';
    applyTheme(saved);

    document.querySelectorAll('.ts').forEach(btn => {
      btn.addEventListener('click', () => applyTheme(btn.dataset.theme));
    });
  </script>
</body>
</html>
